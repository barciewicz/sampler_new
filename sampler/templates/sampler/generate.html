<!DOCTYPE HTML>
    <html>
        <head>
            <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
            <style>
                canvas {
                    border: 1px solid black;
                }
            </style>
        </head>
        <body>
            
            <canvas></canvas>
            <div id="plot"></div>
        </body>
        <script>
            
            
            
            get_data()
                .then(response => response.json())
                .then(json => {
                    draw(json)
                    plot(json.samples)
                })
            
            async function get_data() {
                let data = await fetch('http://127.0.0.1:8000/test')
                return data
            }
            
            async function draw(json) { 
                let num_of_samples = json.samples.length
                
                // set up canvas
                let canvas = document.getElementsByTagName('canvas')[0]
                canvas.width = 800
                canvas.height = 100
                let ctx = canvas.getContext("2d");
                ctx.translate(0, canvas.height / 2) // display waveform in the middle Y of canvas
                
                let x_scale = canvas.width / num_of_samples
                let y_scale = canvas.height * 20
                
                // start drawing the waveform
                ctx.moveTo(0, 0)
                ctx.beginPath()
                json.samples.forEach((sample, index) => {
                    ctx.lineTo(index * x_scale, sample * y_scale)
                })
                ctx.stroke()
            }
            
            function plot(data) {
                console.log(data)
                var trace1 = {
                      //x: data,
                      y: data,
                      mode: 'lines'
                    };

                    var data = [ trace1];
                    var layout = {
                        width: 1000,
                        height: 300,
                    }



                Plotly.newPlot('plot', data, layout);
            }
            
            //~ get_data()
                //~ .then(response => response.json())
                //~ .then(json => plot(json.samples))
        </script>
    </html>
