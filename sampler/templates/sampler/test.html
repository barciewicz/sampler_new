<!DOCTYPE HTML>
	<html>
		<head>
			<style>

			</style>
		</head>
		<body>
			<canvas id="waveform"></canvas>
		</body>
		<script>
			
            class Waveform {
                constructor(container_selector) {
                    this.render(container_selector)
                    this.rects = []
                }
                
                render(container_selector) {
                    this.canvas = document.querySelector(container_selector)
                    this.canvas.width = 800
                    this.canvas.height = 150
                    this.canvas.style.border = '1px solid black'
                    this.ctx = this.canvas.getContext('2d')
                    this.ctx.fillStyle = 'rgba(200, 0, 0, 0.3)'
                    
                    this.canvas.addEventListener('mousedown', this.mouseDown)
                    this.canvas.addEventListener('mousemove', this.mouseMove)
                    this.canvas.addEventListener('mouseup', this.mouseUp)
                }
                
                mouseDown = e => {
                    this.drag = true
                    this.rect = {}
                    this.rect.x = e.clientX - this.canvas.offsetLeft
                    this.rect.y = 0
                    this.rect.w = 1
                    this.rect.h = this.canvas.height
                    this.drawRect(
                        this.rect.x,
                        this.rect.y,
                        this.rect.w,
                        this.rect.h,
                    )
                }
                
                mouseMove = e => {
                    if (this.drag) {
                        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)
                        this.redrawAllRects()
                        this.rect.w = (e.clientX - this.canvas.offsetLeft) - this.rect.x;
                        this.drawRect(
                            this.rect.x,
                            this.rect.y,
                            this.rect.w,
                            this.rect.h,
                        )
                    }
                }
                
                mouseUp = e => {
                    this.drag = false
                    
                    // store rects to redraw them on mousemove
                    this.rects.push({
                        'x': this.rect.x,
                        'y': this.rect.y,
                        'w': this.rect.w,
                        'h': this.rect.h,
                    }) 
                    this.redrawAllRects()
                }
                
                redrawAllRects() {
                    this.rects.forEach(rect => {
                        this.drawRect(rect.x, rect.y, rect.w, rect.h)
                    })
                }
                
                drawRect(x, y, w, h) {
                    this.ctx.strokeRect(x, y, w, h)
                }
            }
            
            let waveform = new Waveform('#waveform')
		
		</script>
	</html>
