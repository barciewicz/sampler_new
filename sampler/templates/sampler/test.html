<!DOCTYPE HTML>
	<html>
		<head>
			<style>
                body {
                    display: flex;
                    flex-direction: column;
                }

			</style>
		</head>
		<body>
			<canvas id="waveform"></canvas>
		</body>
		<script>
			
            class Waveform {
                constructor(container_selector) {
                    this.render(container_selector)
                    this.rects = []
                }
                
                render(container_selector) {
                    this.canvas = document.querySelector(container_selector)
                    this.canvas.width = this.canvas.parentNode.offsetWidth
                    this.canvas.height = 150
                    this.canvas.style.border = '1px solid black'
                    this.ctx = this.canvas.getContext('2d')
                    
                    // rect color
                    this.ctx.fillStyle = 'rgba(200, 0, 0, 0.3)'
                    
                    this.canvas.addEventListener('mousedown', this.mouseDown)
                    this.canvas.addEventListener('mousemove', this.mouseMove)
                    this.canvas.addEventListener('mouseup', this.mouseUp)
                }
                
                mouseDown = e => {
                    this.drag = true
                    this.rect = {}
                    this.rect.x = e.clientX - this.canvas.offsetLeft
                    this.rect.y = 0
                    this.rect.w = 1 // marker-like
                    this.rect.h = this.canvas.height
                    this.drawRect(this.rect)
                }
                
                mouseMove = e => {
                    if (this.drag) {
                        // clear entire canvas
                        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)
                        
                        //redraw all stored rects
                        this.drawAllRects()
                        
                        // resize current rect
                        this.rect.w = (e.clientX - this.canvas.offsetLeft) - this.rect.x;
                        this.drawRect(this.rect)
                    }
                }
                
                mouseUp = e => {
                    this.drag = false
                    
                    // store rects to redraw them on mousemove
                    this.rects.push(this.rect)
                }

                drawRect(rect) {
                    this.ctx.fillRect(rect.x, rect.y, rect.w, rect.h)
                }
                
                drawAllRects() {
                    this.rects.forEach(rect => {
                        this.drawRect(rect)
                    })
                }
            }
            
            let waveform = new Waveform('#waveform')
		
		</script>
	</html>
